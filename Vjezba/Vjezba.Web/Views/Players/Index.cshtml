@model IEnumerable<Vjezba.Model.Player>

@{
    ViewData["Title"] = "Players";
}

<h2>Players</h2>

<div>
    <input type="text" id="searchInput" placeholder="Search players by name..." />
    <button type="button" id="searchButton" class="btn-primary">Search</button>
</div>

<div id="searchResults">
    <!-- Placeholder za rezultate searcha -->
</div>

<table class="table">
    <thead>
        <tr>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Age</th>
            <th>Position</th>
            <th>Team</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td class="p-3">
                    @Html.DisplayFor(modelItem => item.FirstName)
                </td>
                <td class="p-3">
                    @Html.DisplayFor(modelItem => item.LastName)
                </td>
                <td class="p-3">
                    @Html.DisplayFor(modelItem => item.Age)
                </td>
                <td class="p-3">
                    @Html.DisplayFor(modelItem => item.Position)
                </td>
                <td class="p-3">
                    @Html.DisplayFor(modelItem => item.Team.Name)
                </td>
                <td>
                    <a asp-action="Edit" asp-route-id="@item.PlayerId" class="btn btn-primary">Edit</a> |
                    <a asp-action="Details" asp-route-id="@item.PlayerId" class="btn btn-secondary">Details</a> |
                    <a asp-action="Delete" asp-route-id="@item.PlayerId" class="btn btn-danger">Delete</a>
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#searchButton').click(function () {
                var searchQuery = $('#searchInput').val();
                $.ajax({
                    url: '@Url.Action("Search", "Players")',
                    type: 'GET',
                    data: { query: searchQuery },
                    success: function (data) {
                        $('#searchResults').html('');
                        if (data.length > 0) {
                            var resultHtml = '<table class="table"><thead><tr><th>First Name</th><th>Last Name</th><th>Age</th><th>Team</th></tr></thead><tbody>';
                            $.each(data, function (index, player) {
                                resultHtml += '<tr><td>' + player.firstName + '</td><td>' + player.lastName + '</td><td>' + player.age + '</td><td>' + player.teamName + '</td></tr>';
                            });
                            resultHtml += '</tbody></table>';
                            $('#searchResults').html(resultHtml);
                        } else {
                            $('#searchResults').html('<p>No players found.</p>');
                        }
                    },
                    error: function () {
                        $('#searchResults').html('<p>An error occurred while searching. Please try again.</p>');
                    }
                });
            });
        });
    </script>
}
